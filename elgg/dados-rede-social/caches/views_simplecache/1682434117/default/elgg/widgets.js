define("elgg/widgets",['jquery','elgg/Ajax','elgg/i18n','jquery-ui/widgets/sortable'],function($,Ajax,i18n){function moveWidget(event,ui){var guidString=ui.item.attr('id');guidString=guidString.substr(guidString.indexOf('elgg-widget-')+"elgg-widget-".length);var col=ui.item.parent().attr('id');col=col.substr(col.indexOf('elgg-widget-col-')+"elgg-widget-col-".length);var ajax=new Ajax(!1);ajax.action('widgets/move',{data:{widget_guid:guidString,column:col,position:ui.item.index()}})};function removeWidget(event){event.preventDefault();if(confirm(i18n.echo('deleteconfirm'))===!1){return}
$(this).closest('.elgg-module-widget').remove();var ajax=new Ajax(!1);ajax.action($(this).attr('href'))};function toggleWidget(event){event.preventDefault();$(this).toggleClass('elgg-widget-collapsed');$(this).parent().parent().find('.elgg-body').slideToggle('medium')};function saveWidgetSettings(event){event.preventDefault();$(this).parent().slideToggle('medium');var $widgetContent=$(this).parent().parent().children('.elgg-widget-content');$widgetContent.html('<div class="elgg-ajax-loader"></div>');var ajax=new Ajax(!1);ajax.action('widgets/save',{data:$(this).serialize(),success:function(result){$widgetContent.html(result.content);if(result.title!==''){var $widgetTitle=$widgetContent.parent().parent().find('.elgg-widget-title');var newWidgetTitle=result.title;if(result.href!==''){newWidgetTitle="<a href='"+result.href+"' class='elgg-anchor'><span class='elgg-anchor-label'>"+newWidgetTitle+"</span></a>"}
$widgetTitle.html(newWidgetTitle)}}})};$('.elgg-widgets').sortable({items:'div.elgg-module-widget.elgg-state-draggable',connectWith:'.elgg-widgets',handle:'.elgg-widget-handle',forcePlaceholderSize:!0,placeholder:'elgg-widget-placeholder',opacity:0.8,revert:500,stop:moveWidget});$(document).on('click','a.elgg-widget-delete-button',removeWidget);$(document).on('submit','.elgg-widget-edit > form ',saveWidgetSettings);$(document).on('click','a.elgg-widget-collapse-button',toggleWidget)})