<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Colleting Data</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body class="container" style="margin-top: 50px; width: 50%; height:auto; ">
    <h2 class="text-primary" style="margin-left: 15px; margin-bottom: 10px">
        Hey There,Here we are going to upload
    </h2>
    <form class="container" id="contactForm">
        <div class="card">
            <div class="card-body">
                <div class="form-group" style="margin-left: 15px;margin-top: 10px;display:none;">
                    <label for=" exampleFormControlSelect1 ">Select Type</label>
                    <select class="form-control " id="types">
                        <option>1</option>
                    </select>
                </div>
                <br>
                Document Upload:
                <br>
                <input type="file" name="files[]" id="files">
                <input type="hidden" name="url" id="url">
                <button type="button " onclick="uploadimage()">
                    Upload Image
                </button>
                <br><br>
            </div>
        </div>
        <button type="submit " id="submit" class="btn btn-primary " style="margin-left: 15px; margin-top: 10px; display:none; ">
            Submit
        </button>
    </form>
</body>
<script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js "></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js "></script>
<link type="text/css " rel="stylesheet " href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css "/>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js "></script>
<script>
    var firebaseConfig = {
        apiKey: "AIzaSyCQTrUoZ_I-TouDGEaDUAGF7NJmabiYI4U",
        authDomain: "testefirebase-9164d.firebaseapp.com",
        databaseURL: "https://testefirebase-9164d-default-rtdb.firebaseio.com",
        projectId: "testefirebase-9164d",
        storageBucket: "testefirebase-9164d.appspot.com",
        messagingSenderId: "325668866931",
        appId: "1:325668866931:web:982ce0be20f778921e1306",
        measurementId: "G-4VBVZ8T096"
    };
    firebase.initializeApp(firebaseConfig);
    var messagesRef = firebase.database().ref('Checking');
    document.getElementById(
        'contactForm').addEventListener('submit', contactForm);
    //uploading file in storage
    function uploadimage() {
        var type = getInputVal('types');
        var storage = firebase.storage();
        var file = document.getElementById("files").files[0];
        console.log(file);
        var storageref = storage.ref();
        var thisref = storageref.child(type).child(file.name).put(file);
        thisref.on('state_changed', function (snapshot) {
        }, function (error) {
            alert('teste')
        }, function () {
            // Uploaded completed successfully, now we can get the download URL
            thisref.snapshot.ref.getDownloadURL().then(function (downloadURL) {
                //getting url of image
                document.getElementById("url ").value = downloadURL;
                alert('uploaded successfully');
                saveMessage(downloadURL);
            });
        });
        var url = getInputVal('url');
    }
    function getInputVal(id) {
        document.getElementById('contactForm').reset();
    }
    function getInputVal(id) {
        return document.getElementById(id).value;
    }
    function saveMessage(url) {
        var newMessageRef = messagesRef.push();
        newMessageRef.set({
            imageurl: url,
        });
    }
</script>
</html>